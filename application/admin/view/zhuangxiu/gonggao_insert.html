{include file="common/head" /}
<body data-col="2-columns" class=" 2-columns  layout-dark">
<!-- ////////////////////////////////////////////////////////////////////////////-->
<style>
    .ql-toolbar.ql-snow .ql-picker.ql-expanded .ql-picker-options{background: #00bcd4;}
    form .form-group {float: left;margin-left: 2rem;}
    .form-control{width:96%;}


    form .form-group{margin-left: 0;}
</style>
<div class="wrapper">
    <div class="row justify-content-md-center">
        <div class="col-md-9" style="margin-top: 50px;">
            <div class="card">
                <div class="card-body">
                    <div class="px-3">
                        <form class="form">
                            <div class="card-content">
                                <div class="card-body">
                                    <div class="form-body">
                                        <div class="row">

                                            <div class="form-body col-12 mb-2">
                                                <div class="row">
                                                    <div class="form-group col-12 mb-2">
                                                        <label >标题</label>
                                                        <input type="text" class="form-control title" name="title" id="title" value="">
                                                    </div>
                                                </div>
                                            </div>


                                            <div class="form-group col-12 mb-2">
                                                <label >内容</label>
<!--                                                <input type="text" class="form-control" name="cont" id="cont" value="">-->
                                                <div class="am-u-sm-9 am-u-end">
                                                    <!-- 加载编辑器的容器 -->
                                                    <div>
                                                        <textarea id="container" name="content" data-init="rtspe" class="easyui-validatebox" data-options="required:false" placeholder="请输入详情(富文本)" required="required">

                                                        </textarea>
                                                    </div>

                                                    <script type="text/javascript" src="__STATIC__/common/ueditor1_4_3_3-utf8-php/ueditor.config.js"></script>
                                                    <script type="text/javascript" src="__STATIC__/common/ueditor1_4_3_3-utf8-php/ueditor.all.min.js"></script>
                                                    <script type="text/javascript" charset="utf-8" src="__STATIC__/common/ueditor1_4_3_3-utf8-php/lang/zh-cn/zh-cn.js"></script>

                                                    <script type="text/javascript">
                                                        //实例化编辑器
                                                        //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
                                                        var ue = UE.getEditor('container',{});

                                                        UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;
                                                        UE.Editor.prototype.getActionUrl = function(action) {
                                                            console.log(action);
                                                            if (action == 'uploadimage' || action == 'uploadscrawl' || action == 'uploadimage') {
                                                                var origin = window.location.origin;
                                                                return origin+"/sun_admin/upload_aliyun_ht_fwb";//此处写自定义的图片上传路径
                                                            }  else {
                                                                return this._bkGetActionUrl.call(this, action);
                                                            }
                                                        }
                                                    </script>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <div class="form-body">
                                        <div class="row">
                                            <div class="form-group col-12 mb-2">
                                                <label >缩略图 建议像素尺寸 宽X高 【90 X 90】</label>
                                                <div>
                                                    <input type="hidden" class="bklogo_url" id="bklogo_url" name="bklogo" value=""/>
                                                    <img id="bklogo_img" style="width:100px;height:100px;display: none;" name="bklogo_img" src="" class="bklogo_img"/>
                                                    <input type="file" id="bklogo_file" name="bklogo_file"  class="file-loading bklogo_file" onchange="upimg(name,id,this)" accept="image/gif,image/jpeg,image/x-png" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

<!--                                <div class="card-body">-->
<!--                                    <div class="form-body">-->
<!--                                        <div class="row">-->
<!--                                            <div class="form-group col-12 mb-2">-->
<!--                                                <label >长图 建议像素尺寸 宽X高【640 X 自定义】</label>-->
<!--                                                <div>-->
<!--                                                    <input type="hidden" class="bklogo_url" id="ct_url" name="bklogo" value=""/>-->
<!--                                                    <img id="ct_img" style="width:100px;height:100px;display: none; " name="bklogo_img" src="" class="bklogo_img"/>-->
<!--                                                    <input type="file" id="ct_file" name="bklogo_file"  class="file-loading bklogo_file" onchange="ctupimg(name,id,this)" accept="image/gif,image/jpeg,image/x-png" />-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->


                                <div class="form-actions center">
                                    <button type="button" class="btn btn-raised btn-primary add">
                                        <i class="fa fa-check-square-o"></i> 提交
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>

<!-- BEGIN VENDOR JS-->
<script src="http://img.lll1.vip/apex-assets/vendors/js/core/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/core/popper.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/core/bootstrap.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/prism.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/jquery.matchHeight-min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/screenfull.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/pace/pace.min.js" type="text/javascript"></script>
<!-- BEGIN VENDOR JS-->
<!-- BEGIN PAGE VENDOR JS-->
<!-- END PAGE VENDOR JS-->
<!-- BEGIN APEX JS-->
<script src="http://img.lll1.vip/apex-assets/js/app-sidebar.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/js/notification-sidebar.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/js/customizer.js" type="text/javascript"></script>
<!-- END APEX JS-->
<!-- BEGIN PAGE LEVEL JS-->
<script src="http://img.lll1.vip/apex-assets/vendors/js/sweetalert2.min.js" type="text/javascript"></script>
<script src="http://img.lll1.vip/apex-assets/vendors/js/toastr.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL JS-->



<script>
    $(".add").click(function(){

        var cont      = UE.getEditor('container').getContent();
        var img      = $('#bklogo_url').val();
        var image      = $('#ct_url').val();
        var title      = $('#title').val();

        $.ajax({
            type: 'post',
            url: '/sun_admin/gonggao_insert_sub',
            dataType: 'json',
            data: {"cont":cont,"img":img,"image":image,"title":title},
            success: function(res){
                if(res.status == '200')
                {
                    swal(
                        res.msg,
                        '',
                        'success'
                    );
                    var index = parent.layer.getFrameIndex(window.name);
                    setTimeout(function(){parent.layer.close(index);},1800);
                }else{
                    swal(
                        res.msg,
                        '',
                        'error'
                    );
                }
            },
        });
    })

    //上传图片 logo
    function upimg(da,id,obj){
        console.log(obj);

        if( obj.value == "" ) {
            return;
        }
        var formdata = new FormData();
        formdata.append("img" , $(obj)[0].files[0]);//获取文件法二

        $.ajax({
            type : 'post',
            url : '/upload_alioos', //接口
            data : formdata,
            cache : false,
            processData : false, // 不处理发送的数据，因为data值是Formdata对象，不需要对数据做处理
            contentType : false, // 不设置Content-type请求头
            success : function(response){
                console.log(response.datas);
                if(response.status == 200){

                    var imgsrcname = '#bklogo_img';//图片的src
                    var imgsrcurl = '#bklogo_url';//隐藏的input的图片链接
                    var imgsrcfile = '#bklogo_file';//上传图片的input

                    $(imgsrcname).attr('src',response.datas.url);//赋值到img的src
                    $(imgsrcname).css('display','block');//显示img
                    $(imgsrcurl).val(response.datas.url);//赋值到input的value
                    // $(imgsrcfile).css('display','none');//隐藏文件上传框

                }else {
                    swal(
                        response.msg,
                        '',
                        'error'
                    );
                }
            },
            error : function(){ }
        });

    }

    //上传图片 长图
    function ctupimg(da,id,obj){
        console.log(obj);

        if( obj.value == "" ) {
            return;
        }
        var formdata = new FormData();
        formdata.append("images" , $(obj)[0].files[0]);//获取文件法二

        $.ajax({
            type : 'post',
            url : '/upload_alioos', //接口
            data : formdata,
            cache : false,
            processData : false, // 不处理发送的数据，因为data值是Formdata对象，不需要对数据做处理
            contentType : false, // 不设置Content-type请求头
            success : function(response){
                console.log(response.datas);
                if(response.status == 200){

                    var imgsrcname = '#ct_img';//图片的src
                    var imgsrcurl = '#ct_url';//隐藏的input的图片链接
                    var imgsrcfile = '#ct_file';//上传图片的input

                    $(imgsrcname).attr('src',response.datas.url);//赋值到img的src
                    $(imgsrcname).css('display','block');//显示img
                    $(imgsrcurl).val(response.datas.url);//赋值到input的value
                    // $(imgsrcfile).css('display','none');//隐藏文件上传框

                }else {
                    swal(
                        response.msg,
                        '',
                        'error'
                    );
                }
            },
            error : function(){ }
        });

    }

</script>
</body>
<!-- END : Body-->
</html>